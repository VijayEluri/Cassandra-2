#! /usr/bin/env bash
bin=`dirname "$0"`
bin=`cd "$bin"; pwd`

confpath="$bin/../conf"
cygwin=false
case "`uname`" in
CYGWIN*) cygwin=true;;
esac


# CLASSPATH initially contains cassandra jar
CLASSPATH="$bin/../build/cassandra.jar"

# add libs to CLASSPATH
for f in $bin/../lib/*.jar; do
  CLASSPATH=${CLASSPATH}:$f;
done

CLASSPATH=conf:${CLASSPATH};

# cygwin path translation
if $cygwin; then
echo "in cygwin"
echo $CLASSPATH
  CLASSPATH=`cygpath -p -w "$CLASSPATH"`
confpath=`cygpath -p -w "$confpath"`
fi


# run it
java -Xdebug -Xrunjdwp:transport=dt_socket,server=y,address=8888,suspend=n -Xms128M -Xmx2G -XX:SurvivorRatio=8 -XX:TargetSurvivorRatio=90 -XX:+AggressiveOpts -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=1 -XX:+CMSParallelRemarkEnabled -XX:+HeapDumpOnOutOfMemoryError -Dcom.sun.management.jmxremote.port=8080 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -Dcassandra -Dstorage-config="$confpath" -cp "$CLASSPATH" org.apache.cassandra.service.CassandraServer &
